---
description: TypeScript2.3のリリース内容まとめ
---

# [TypeScript] 2.3

{{ page.meta.description }}

## [Generators and Iteration for ES5/ES3]

[Generators and Iteration for ES5/ES3]: https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-3.html#generators-and-iteration-for-es5es3

{{label('should')}} {{label('easy')}} 

`--downlevelIteration`フラグを付けることで、targetがES5/ES3でもジェネレータとイテレータをサポートするようになった。

| --downlevelIteration        | target=ES3 | target=ES5 | target=ES2015以降 |
| --------------------------- | ---------- | ---------- | ----------------- |
| **あり**                    | **O**      | **O**      | O                 |
| なし                        | X          | X          | O                 |

もちろん`tsconfig.json`の指定でOK。

=== "tsconfig.json"
    ```json
    {
      "compilerOptions": {
        "target": "es5",
        "downlevelIteration": true
      }
    }
    ```

=== "main.ts"
    ```ts
    function* gener() {
        yield 1
        yield 2
    }

    // downlevelIterationがfalse かつ targetがES2015より前だとここでエラーになる
    for (const v of gener()) {
        console.log(v)
    }
    ```


## [Async Iteration]

[Async Iteration]: https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-3.html#async-iteration

{{label('should')}} {{label('normal')}} 

`Iterator`と`Generator`のAsyncバージョンとして、`AsyncIterator`と`AsyncGenerator`が追加された。

| 項目           | 主な利用シーン (他にもあるはず)                        |
| -------------- | ------------------------------------------------------ |
| AsyncIterator  | `next`や`return`、`throw`の実装で`await`を使いたいとき |
| AsyncGenerator | generator functionの実装で`await`を使いたいとき        |

`AsyncIterator`と`AsyncGenerator`を使うには、`for`の代わり`for await`を使う。

```typescript
const lazyGet = (response: string, delaySec: number): Promise<string> =>
    new Promise((resolve) => setTimeout(() => resolve(response), delaySec * 1000))

interface ApiResponse {
    res1: string
    res2: string
}

async function* gener(): AsyncGenerator<ApiResponse> {
    yield {
        res1: await lazyGet("res1", 0.5),
        res2: await lazyGet("res2", 1),
    }

    yield {
        res1: await lazyGet("res100", 3),
        res2: await lazyGet("res200", 0.01),
    }
}

async function main() {
    console.log("Begin")
    // async function* のreturn型 AsyncGenerator<...> は 普通のfor文では回せない
    for await (const v of gener()) {
        console.log(v)
    }
    console.log("End")
}

main()
// Begin
// ... 1秒待ち (2並列で遅い方を待つ)
// { res1: 'res1', res2: 'res2' }
// ... 3秒待ち (2並列で遅い方を待つ)
// { res1: 'res100', res2: 'res200' }
// End
```

!!! warning "targetがES5以前の場合"
    `--downlevelIteration`が必要なので注意。
